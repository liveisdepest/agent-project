# DuckDuckGo Search MCP + Irrigation MCP 完整系统架构书

> 面向项目：agent-project（基于 MCP 的智能农业灌溉决策系统）
> 架构目标：**低依赖搜索 + 可解释决策 + 灌溉执行闭环**

---

## 1. 架构设计背景与设计原则

### 1.1 背景说明

在智能农业灌溉决策中，系统通常需要三类信息来源：

1. **现场执行能力**（是否灌溉、如何灌溉）
2. **外部环境预测**（天气、降雨）
3. **农业经验与知识**（作物需水规律、灌溉时机）

其中，第 3 类信息不适合硬编码规则，也不适合依赖高成本或不稳定的商业搜索 API。

因此，本系统采用：

> **DuckDuckGo Search MCP（无 API key） + 重构 Irrigation MCP（执行层）**

构成“知识辅助决策 + 物理执行”的双 MCP 架构。

---

### 1.2 核心设计原则

* **低外部依赖**：搜索服务不依赖 API key
* **结构化输出**：搜索结果适合 LLM 直接推理
* **职责单一**：搜索 ≠ 执行
* **决策可解释**：每一步有清晰信息来源

---

## 2. 系统总体架构

### 2.1 系统整体逻辑

```
┌────────────────────┐
│     MCP Client     │  ← 决策中枢（LLM Agent）
└───────┬────────────┘
        │
        │ MCP Tools
        ▼
┌────────────────────┐        ┌────────────────────┐
│ DuckDuckGo Search  │        │  Irrigation MCP    │
│      MCP Server    │        │ (灌溉执行服务器) │
└────────────────────┘        └────────┬───────────┘
                                         │
                                     阀门 / 水泵
```

---

### 2.2 MCP 职责划分

| MCP Server            | 核心职责          | 系统角色 |
| --------------------- | ------------- | ---- |
| DuckDuckGo Search MCP | 农业知识 / 灌溉经验搜索 | 知识层  |
| Irrigation MCP        | 控制灌溉设备        | 执行层  |
| Weather MCP（已有）       | 天气与降雨预测       | 外部环境 |
| Filesystem MCP        | 日志与结果记录       | 记忆层  |

---

## 3. DuckDuckGo Search MCP 架构设计

### 3.1 Search MCP 的定位

> **Search MCP 是系统的“知识补充层”，为灌溉决策提供定性依据**

其核心目标不是“搜索网页”，而是：

* 为 LLM 提供 **可信、结构化、可引用的农业知识片段**

---

### 3.2 选用 DuckDuckGo 的原因

* ❌ 不需要 API key
* ✅ 搜索结果天然去广告、偏文本
* ✅ 易于提取 title / snippet / url
* ✅ 非常适合农业、科研、技术类查询

---

### 3.3 DuckDuckGo Search MCP Tools 设计

#### 3.3.1 web_search

**功能说明**
基于 DuckDuckGo 搜索引擎，查询指定关键词并返回结构化结果。

**输入参数示例**

* query: 搜索关键词
* max_results: 返回条数

**返回结构示例**

* title
* snippet
* url

---

### 3.4 Search MCP 工程结构（示意）

```
server/
 └─ search/
     ├─ main.py              # MCP server 入口
     ├─ duckduckgo.py        # 搜索实现
     ├─ tools/
     │   └─ web_search.py
     └─ config.yaml
```

---

## 4. 重构 Irrigation MCP 架构设计

### 4.1 Irrigation MCP 的定位

> **Irrigation MCP 是系统唯一具有物理副作用的执行服务器**

其职责被严格限定为：

* 接收 Agent 的灌溉决策
* 执行灌溉动作

---

### 4.2 Irrigation MCP Tools 设计

#### 4.2.1 start_irrigation

* 参数：zone, duration_minutes
* 行为：启动指定区域灌溉

---

#### 4.2.2 stop_irrigation

* 行为：立即停止灌溉

---

#### 4.2.3 get_irrigation_status（可选）

* 返回当前灌溉状态

---

### 4.3 Irrigation MCP 工程结构（示意）

```
server/
 └─ irrigation/
     ├─ main.py
     ├─ actuators/
     │   ├─ valve.py
     │   └─ pump.py
     ├─ tools/
     │   ├─ start_irrigation.py
     │   ├─ stop_irrigation.py
     │   └─ get_status.py
     └─ config.yaml
```

---

## 5. Agent 决策流程（标准版）

```
1. 调用 Weather MCP → 获取未来降雨预测
2. 调用 DuckDuckGo Search MCP → 查询作物需水与灌溉经验
3. LLM 综合分析（定量 + 定性）
4. 判断是否需要灌溉
5. 若需要 → 调用 Irrigation MCP → start_irrigation
6. 记录决策与执行结果（Filesystem MCP）
```

---

## 6. 架构优势分析（论文可直接使用）

1. **搜索服务低依赖、稳定性高**
2. **农业知识获取方式自然、可解释**
3. **执行层职责清晰，安全性高**
4. **LLM 决策过程可追溯**

---

## 7. 论文章节映射建议

| 架构内容              | 论文章节     |
| ----------------- | -------- |
| Search MCP 设计     | 知识获取模块设计 |
| Irrigation MCP 设计 | 执行层设计    |
| 决策流程              | 智能灌溉决策方法 |
| MCP 协同机制          | 系统工作流程   |

---

## 8. 小结

通过引入 **DuckDuckGo Search MCP（无 API key）** 并对 **Irrigation MCP 进行执行层重构**，系统在不增加外部依赖的前提下，实现了农业知识驱动的智能灌溉决策，并保持了良好的工程可实现性与学术可解释性。
